################################################################################
# Marginal Likelihood Gaussian Predictive Process
################################################################################

mar_lik_GPP <- function(s2,
                        t2,
                        l2,
                        y,
                        Dkk,
                        Dks){
  ##############################################################################
  # Dimensions
  # Number of Observations
  N   <- length(y)
  ##############################################################################
  
  ##############################################################################
  # Auxiliary Variables
  # Covariances
  Ckk <- t2 * exp(- Dkk / l2)
  Cks <- t2 * exp(- Dks / l2)
  K   <- Ckk + Cks %*% t(Cks) / s2
  eK  <- eigen(K)
  Cy  <- Cks %*% y
  # Loglikelihood
  log <-     - N * log(2 * pi) / 2
  log <- log - (sum(log(eK$values)) + N * log(s2) - log(det(Ckk))) / 2
  log <- log - t(y) %*% y / (2 * s2)
  log <- log + t(Cy) %*% eK$vectors %*% diag(1 / eK$values) %*% t(eK$vectors) %*% Cy / (2 * s2^2)
  ##############################################################################
  
  ##############################################################################
  # Returns
  return(log)
  ##############################################################################
  
}